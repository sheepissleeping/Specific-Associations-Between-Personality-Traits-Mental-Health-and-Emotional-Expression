# ============================================================
# 00_run_all.R
# ä¸»æ§è„šæœ¬ï¼šæŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰åˆ†æ
#
# ä½¿ç”¨æ–¹æ³•ï¼š
#   1. æŠŠ "åŸå§‹æ•°æ®.xlsx" æ”¾åœ¨æœ¬è„šæœ¬åŒä¸€ç›®å½•
#   2. åœ¨ R / RStudio ä¸­è¿è¡Œæœ¬è„šæœ¬
#      source("00_run_all.R")
#   æˆ–åœ¨ R å‘½ä»¤è¡Œï¼šRscript 00_run_all.R
# ============================================================

cat("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n")
cat("â•‘  Personality Ã— Emotion Ã— Mental Health Analysis      â•‘\n")
cat("â•‘  Lingping Meng, Mingzheng Li, Xiao Sun               â•‘\n")
cat("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n")

# å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºæœ¬è„šæœ¬æ‰€åœ¨æ–‡ä»¶å¤¹
# ï¼ˆRStudio ä¸­æ¨èç”¨ Session â†’ Set Working Directory â†’ Source File Locationï¼‰
# setwd(dirname(rstudioapi::getSourceEditorContext()$path))

# æ£€æŸ¥åŸå§‹æ•°æ®æ–‡ä»¶
if (!file.exists("åŸå§‹æ•°æ®.xlsx")) {
  stop("âŒ æœªæ‰¾åˆ° 'åŸå§‹æ•°æ®.xlsx'ï¼Œè¯·å°†æ•°æ®æ–‡ä»¶æ”¾åœ¨å½“å‰å·¥ä½œç›®å½•ã€‚\n",
       "   å½“å‰ç›®å½•ï¼š", getwd())
}

# è„šæœ¬æ‰§è¡Œé¡ºåº
scripts <- c(
  "01_data_preprocessing.R",        # æ•°æ®æ¸…æ´—ã€è§£ææƒ…ç»ªæ¦‚ç‡ã€æ­£æ€æ€§æ£€éªŒ
  "02_age_group_analysis.R",         # å¹´é¾„ç»„ Ã— SCL-90 & Big Five å·®å¼‚ï¼ˆTable 2, 3ï¼‰
  "03_emotion_clustering.R",         # K-means æƒ…ç»ªèšç±»ï¼ˆFigure 1, 2, 3ï¼‰
  "04_cluster_personality_symptoms.R", # èšç±»ç»„ Ã— äººæ ¼ & ç—‡çŠ¶å·®å¼‚ï¼ˆTable 4, 5ï¼‰
  "05_mental_health_risk.R"          # é£é™©è¯„ä¼° & Logistic å›å½’ & ROCï¼ˆTable 6,7,8, Fig 4ï¼‰
)

for (script in scripts) {
  cat(rep("â”€", 58), "\n", sep = "")
  cat("â–¶ è¿è¡Œ:", script, "\n")
  cat(rep("â”€", 58), "\n", sep = "")
  tryCatch(
    source(script, echo = FALSE),
    error = function(e) {
      cat("âŒ è„šæœ¬å‡ºé”™:", conditionMessage(e), "\n")
      cat("   è¯·æ£€æŸ¥è¯¥è„šæœ¬åé‡æ–°è¿è¡Œã€‚\n")
    }
  )
  cat("\n")
}

cat("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n")
cat("â•‘  âœ… æ‰€æœ‰åˆ†æå®Œæˆï¼                                    â•‘\n")
cat("â•‘                                                      â•‘\n")
cat("â•‘  ç”Ÿæˆçš„æ–‡ä»¶ï¼š                                         â•‘\n")
cat("â•‘  ğŸ“Š æ•°æ®:  data_processed.rds                        â•‘\n")
cat("â•‘            data_clustered.rds                        â•‘\n")
cat("â•‘            data_final.rds                            â•‘\n")
cat("â•‘            cluster_assignments.csv                   â•‘\n")
cat("â•‘  ğŸ“‹ è¡¨æ ¼:  table2_scl90_age_kw.csv                   â•‘\n")
cat("â•‘            table3_big5_age_kw.csv                    â•‘\n")
cat("â•‘            table4a_facets_by_cluster.csv             â•‘\n")
cat("â•‘            table4b_big5_by_cluster.csv               â•‘\n")
cat("â•‘            table5_scl90_by_cluster.csv               â•‘\n")
cat("â•‘            table6_risk_distribution.csv              â•‘\n")
cat("â•‘            table7_personality_by_risk.csv            â•‘\n")
cat("â•‘            table8_logistic_coefs.csv                 â•‘\n")
cat("â•‘  ğŸ–¼  å›¾ç‰‡:  fig1_optimal_k.png                        â•‘\n")
cat("â•‘            fig2_pca_clusters.png                     â•‘\n")
cat("â•‘            fig3_emotion_boxplots.png                 â•‘\n")
cat("â•‘            fig4_roc_curve.png                        â•‘\n")
cat("â•‘            fig_age_group_differences.png             â•‘\n")
cat("â•‘            fig_radar_big5_clusters.png               â•‘\n")
cat("â•‘            fig_cluster_personality_symptoms.png      â•‘\n")
cat("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")
